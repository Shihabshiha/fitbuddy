import{a as n,u as D,b as H,h as L,l as P,j as e,U as N,k as z,B as U,ac as O,A as C,n as h,m as V,ad as Y,p as q}from"./index-ee55ad39.js";import{F as G,f as J}from"./index-e8437692.js";import{f as K,I as Q}from"./index-92cf1c6a.js";import"./index-c5a87f25.js";function W({title:l,titleId:d,...f},x){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:x,"aria-labelledby":d},f),l?n.createElement("title",{id:d},l):null,n.createElement("path",{d:"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"}))}const X=n.forwardRef(W),Z=X,re=()=>{const l=n.useRef(null),[d,f]=n.useState([]),[x,w]=n.useState(""),[c,I]=n.useState(""),[p,M]=n.useState(null),[u,v]=n.useState(null),[S,y]=n.useState(null),[A,j]=n.useState(!1),b=D(),o=H(L),i=P(U),T=async()=>{var t,a;try{const s=await O();f(s.data.chatList)}catch(s){s instanceof C&&((a=(t=s.response)==null?void 0:t.data)!=null&&a.error)?h(s.response.data.error,"error"):h("something went wrong","error")}},E=()=>{l.current&&(l.current.scrollTop=l.current.scrollHeight)};n.useEffect(()=>{E()},[o]),n.useEffect(()=>{T()},[]);const R=t=>{w(t.target.value)},_=async()=>{var a,s;const t=x;try{if(c&&i){const r={content:t,sender:"trainer",messageType:"text",chatId:c};i.emit("send_message",r),w("")}}catch(r){r instanceof C&&((s=(a=r.response)==null?void 0:a.data)!=null&&s.error)?h(r.response.data.error,"error"):h("something went wrong","error")}},$=async t=>{var s,r;i.emit("join_chat",t),i.on("receive_message",m=>{console.log("incoming messagr",m),o.some(g=>g._id!==m._id)||b(V(m))}),I(t);const a=await Y(t);M((s=a.data)==null?void 0:s.userInfo.participants.userId),b(q(((r=a.data)==null?void 0:r.chats)??[]))},B=t=>{if(t.target.files&&t.target.files.length>0){const a=t.target.files[0];v(a);const s=new FileReader;s.onload=r=>{r.target&&(y(r.target.result),j(!0))},s.readAsDataURL(a)}},F=async()=>{if(u&&c&&i){const a={content:new Blob([u],{type:u.type}),sender:"trainer",messageType:"image",chatId:c,mimeType:u.type};i.emit("send_message",a)}else h("something went wrong","error");j(!1)},k=()=>{y(null),v(null),j(!1)};return e.jsxs("div",{className:"container w-full h-full",children:[e.jsxs("div",{className:"flex h-16",children:[e.jsx("div",{className:"bg-custom-deeper-chat w-1/4 flex items-center text-2xl pl-4 font-semibold border-r",children:e.jsx("h1",{className:"text-white",children:"Messages"})}),p&&e.jsxs("div",{className:"flex w-3/4 items-center pl-2 bg-custom-deeper-chat",children:[e.jsx("img",{src:p.profileImage||N,alt:"img",className:"w-10 h-10 rounded-full object-cover mr-3"}),e.jsxs("p",{className:"text-lg font-sans text-white",children:[p.firstName," ",p.lastName]})]})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/4 h-[72vh] bg-custom-chat border-r-2",children:d?d.map((t,a)=>e.jsxs("div",{className:"flex items-center p-2  hover:bg-blue-gray-50 border-b text-white hover:text-black hover:cursor-pointer",onClick:()=>$(t._id),children:[e.jsx("img",{src:t.participants.userId.profileImage||N,alt:"",className:"w-10 h-10 object-cover rounded-full"}),e.jsxs("p",{className:"ml-2  font-semibold",children:[t.participants.userId.firstName,t.participants.userId.lastName]})]},a)):e.jsx("div",{children:e.jsx("h1",{children:"No chat list"})})}),o.length>0&&c?e.jsx("div",{ref:l,className:"w-3/4 h-[72vh] bg-blue-gray-50 overflow-auto",children:o==null?void 0:o.map((t,a)=>{const s=t.sender.senderType==="trainers",r=t.messageType==="image",m=new Date(t.createdAt),g=K(m,"h.mm a");return e.jsx("div",{className:`grid p-2 ${s?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:"flex",children:[s&&e.jsxs("div",{className:`bg-${s?"green-500":"gray-700"} text-white rounded ${s?"rounded-tr-none":"rounded-tl-none"} px-2 py-2 text-end`,children:[r?e.jsx("img",{src:t.content,alt:"Image",className:"w-[70vh] h-[50vh] object-cover rounded"}):e.jsx("p",{className:s?"":"text-white",children:t.content}),e.jsx("span",{className:`text-${s?"blue-gray-100":"blue-gray-200"} text-sm`,children:g})]}),e.jsx("span",{"data-icon":s?"tail-out":"tail-in",className:"p0s8B",children:e.jsxs("svg",{viewBox:"0 0 8 13",height:"13",width:"8",preserveAspectRatio:"xMidYMid meet",className:`text-${s?"gray":"gray-700"}`,version:"1.1",x:"0px",y:"0px",enableBackground:"new 0 0 8 13",children:[e.jsx("path",{opacity:"0.13",fill:s?"#00a884":"#0000000",d:s?"M5.188,1H0v11.193l6.467-8.625C7.526,2.156,6.958,1,5.188,1z":"M1.533,3.568L8,12.193V1H2.812C1.042,1,0.474,2.156,1.533,3.568z"}),e.jsx("path",{fill:s?"#00a884":"currentColor",d:s?"M5.188,0H0v11.193l6.467-8.625C7.526,1.156,6.958,0,5.188,0z":"M1.533,2.568L8,11.193V0L2.812,0C1.042,0,0.474,1.156,1.533,2.568z"})]})}),!s&&e.jsxs("div",{className:`bg-${s?"custom-chat-msg-right":"gray-700"} text-white rounded ${s?"rounded-tr-none":"rounded-tl-none"} px-2 py-2 text-end`,children:[r?e.jsx("img",{src:t.content,alt:"Image",className:"w-[70vh] h-[50vh] object-cover rounded"}):e.jsx("p",{className:s?"":"text-white",children:t.content}),e.jsx("span",{className:`text-${s?"blue-gray-100":"blue-gray-200"} text-sm`,children:g})]})]})},a)})}):e.jsx("div",{className:"flex justify-center items-center w-3/4",children:e.jsx("h1",{className:"text-3xl font-semibold",children:"Start chat"})})]}),c&&o&&e.jsxs("div",{className:"mt-1 ml-64 pl-3 flex items-center",children:[e.jsx("label",{htmlFor:"fileInput",children:e.jsx(G,{icon:J,className:"text-blue-gray-800 text-xl ml-3 mr-2 hover:cursor-pointer"})}),e.jsx("input",{type:"file",id:"fileInput",accept:"image/*",style:{display:"none"},onChange:B}),e.jsx("input",{type:"text",placeholder:"Enter your message",className:"bg-white rounded px-2 py-1 w-full",value:x,onChange:R}),e.jsx(Z,{className:"h-8 w-8 text-gray-500 hover:cursor-pointer",onClick:()=>_()})]}),e.jsx(Q,{isOpen:A,onClose:k,imagePreview:S,onSend:F}),e.jsx(z,{})]})};export{re as default};
